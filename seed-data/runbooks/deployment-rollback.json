{
  "runbook_id": "runbook-deployment-rollback",
  "title": "Deployment Rollback for Failed or Degrading Releases",
  "description": "Procedure for rolling back a Kubernetes deployment when a release causes service degradation. Includes targeted rollback to a specific revision, replica scaling during rollback, and health verification.",
  "content": "When a deployment is identified as causing service degradation: (1) Confirm the deployment correlation via change analysis, (2) Scale up healthy replicas to handle traffic during rollback, (3) Initiate rollback to the last known good revision, (4) Monitor service health metrics during rollback, (5) Scale replicas back to normal once health is confirmed, (6) Create a Jira ticket for the deploying team with root cause analysis.",
  "incident_types": [
    "deployment_failure",
    "service_degradation",
    "error_spike"
  ],
  "applicable_services": [
    "api-gateway",
    "payment-service",
    "user-service",
    "notification-svc"
  ],
  "severity_levels": [
    "critical",
    "high",
    "medium"
  ],
  "steps": [
    {
      "order": 1,
      "action": "Confirm deployment correlation via LOOKUP JOIN change analysis",
      "command": "vigil-esql-change-correlation",
      "target_system": "elasticsearch",
      "approval_required": false,
      "rollback_command": null
    },
    {
      "order": 2,
      "action": "Scale up healthy replicas to handle traffic during rollback",
      "command": "kubectl scale deployment/{{deployment_name}} --replicas={{current_replicas + 2}} -n vigil-demo",
      "target_system": "kubernetes",
      "approval_required": false,
      "rollback_command": "kubectl scale deployment/{{deployment_name}} --replicas={{current_replicas}} -n vigil-demo"
    },
    {
      "order": 3,
      "action": "Rollback deployment to the revision before the bad commit",
      "command": "kubectl rollout undo deployment/{{deployment_name}} -n vigil-demo",
      "target_system": "kubernetes",
      "approval_required": true,
      "rollback_command": "kubectl rollout undo deployment/{{deployment_name}} -n vigil-demo"
    },
    {
      "order": 4,
      "action": "Monitor service health metrics for 60 seconds post-rollback",
      "command": "vigil-esql-health-monitor",
      "target_system": "elasticsearch",
      "approval_required": false,
      "rollback_command": null
    },
    {
      "order": 5,
      "action": "Scale replicas back to normal count",
      "command": "kubectl scale deployment/{{deployment_name}} --replicas={{current_replicas}} -n vigil-demo",
      "target_system": "kubernetes",
      "approval_required": false,
      "rollback_command": null
    }
  ],
  "historical_success_rate": 0.91,
  "times_used": 8,
  "last_used_at": "2026-02-12T09:15:00.000Z",
  "tags": [
    "deployment",
    "rollback",
    "kubernetes",
    "service-degradation",
    "change-correlation"
  ],
  "content_vector": [
    -0.01633991597997473,
    -0.009195822915167816,
    0.11097957562842183,
    0.04301077319110909,
    0.03931141109328107,
    0.019999851681479077,
    0.034789925225938365,
    0.021197723065593237,
    0.06610280007030853,
    0.014528603220213942,
    0.011849007068980882,
    0.06501677057848089,
    0.039144742155882,
    0.062111264765568865,
    -0.10364774675914112,
    0.04331397978721293,
    0.031854057963719366,
    0.04254750421463252,
    -0.05025560641265884,
    -0.07054976326863034,
    -0.019056192609720395,
    -0.02062128132761429,
    0.1044368643337639,
    0.0036273298342654192,
    0.029591143972360828,
    0.020002258054367828,
    0.014037592420791235,
    -0.012087504256251842,
    0.0121020580186376,
    0.02309519155339078,
    0.032663124064122556,
    0.02348090700911168,
    0.0005075622118096908,
    0.0010075288029107964,
    -0.0005939831251918609,
    0.03475480345543051,
    -0.008827523912061267,
    -0.010654596109786797,
    -0.03974979294227997,
    0.05796692362198034,
    -0.00931885392636572,
    -0.03496934259848924,
    -0.039652464820889556,
    -0.09973426904450784,
    -0.05865400812193111,
    -0.0029701317975086186,
    -0.003992070858360808,
    -0.10424069252391432,
    -0.06223871832154876,
    0.07322244898103494,
    -0.002372801805120554,
    -0.08526837280168617,
    -0.01529531708583844,
    0.02924757804679335,
    0.05798728668553619,
    -0.0063066234681717955,
    -0.010029912122029548,
    0.1461336574999358,
    0.0187371389578951,
    -0.08542097284876529,
    0.009156235379563464,
    -0.008661775168312211,
    -0.0002810434067548916,
    -0.015555455777856657,
    0.017909058261791167,
    -0.015565043804410466,
    0.030124105345519445,
    -0.011831694004013122,
    0.07210047580203356,
    -0.07679231285124379,
    -0.056214577582058826,
    0.044613627686566175,
    -0.0066680763551552015,
    -0.025376848586289927,
    0.016813276301426365,
    -0.018479020695957287,
    0.002618204079170365,
    -0.01963381474608339,
    -0.10510639406052792,
    0.010777662369553742,
    -0.028325375630428157,
    -0.04770523297194716,
    -0.02375959622973043,
    -0.02609477878188024,
    -0.01304852991725488,
    -0.07638694087583388,
    -0.1667753083558979,
    -0.07235989111616827,
    0.0008331134301997224,
    -0.017223850227489915,
    0.09520308955013682,
    0.027556869961510407,
    -0.009928862841283909,
    -0.026892444158548922,
    0.02872718919011648,
    -0.002724534866595218,
    -0.007127925411862755,
    0.05344153919059874,
    -0.04573781197306972,
    -0.021496534607285966,
    0.052761470234887246,
    0.05974093840986888,
    0.019286724300284983,
    -0.03337887854760066,
    0.040274779306338375,
    0.04562271894179759,
    -0.015423271830651971,
    0.10050987165760561,
    -0.0532248818700791,
    -0.02781521792609161,
    -0.03951712049224694,
    0.02397931247943305,
    0.04264016774722369,
    -0.02888709948434462,
    -0.06041499934477469,
    0.051646639785292305,
    0.02972856772627052,
    -0.06481768650110467,
    -0.0861292577228104,
    0.008431058573254022,
    0.00863739172469531,
    -0.08069729343292623,
    -0.04548141387910287,
    0.004569066351148954,
    -0.03898273206035113,
    -0.08566882501562954,
    -0.011165127906065974,
    0.004670217809601521,
    -0.016366954408415048,
    0.06162573456177036,
    0.04256707466245503,
    0.0406917405571653,
    -0.08313971126747305,
    -0.020341055784283284,
    0.023957226513371663,
    -0.09268132141065243,
    0.014348800943976293,
    0.029600985659601373,
    -0.01755280794070507,
    -0.007955447134918602,
    -0.07076883832831886,
    -0.01183056978049125,
    -0.005010600243875408,
    0.030026191657188853,
    0.011843810030828716,
    0.026948637845019725,
    -0.0065823626910543115,
    0.09590506391627097,
    0.04426936910645479,
    0.06980029963703856,
    -0.005601540572046571,
    0.02130148103765976,
    -0.0008959925874331015,
    -0.0863816745214987,
    0.018565873702191853,
    0.027661838702616223,
    0.024713752092462148,
    0.04966316637488926,
    -0.012157277248335577,
    0.042098851259188955,
    -0.016436202906418566,
    -0.006626105179412246,
    0.020240637798926982,
    -0.045157903526963084,
    0.0037650534876250623,
    0.06258799237411419,
    -0.03666439187190096,
    -0.05670923742015104,
    0.09368437713156294,
    0.0019005056216804682,
    0.03841651520876425,
    0.01906644417033173,
    -0.0307429566998275,
    -0.044210060762114235,
    -0.05078623661410579,
    -0.0032324228901531265,
    0.05710292716898224,
    -0.03523292170697986,
    -0.03353357229373941,
    0.05106504631904799,
    -0.033993758888904074,
    0.013362153203968871,
    0.05077321533510296,
    0.017242020754983416,
    0.03723007569583739,
    -0.05259334567903825,
    -0.02705526532055356,
    -0.036077871189026035,
    0.0023427999934776495,
    -0.09398992292811129,
    0.04555671963288494,
    0.10279779219893566,
    0.014965994044186724,
    0.0514518365707201,
    -0.06893479563360948,
    -0.009446145605490694,
    -0.01392042481643514,
    -0.09050418913050338,
    0.01672565058875764,
    -0.00813713228359507,
    -0.01685567813009856,
    -0.03440675144785253,
    -0.02916015016156849,
    0.02525910658262065,
    -0.04266078574038679,
    -0.09102999636383148,
    0.011045757027786174,
    0.051526955750212676,
    0.08010551910343723,
    -0.04328508373526641,
    -0.002365355988852992,
    0.0038047938941501583,
    0.06710928903385872,
    -0.0504388260012579,
    0.02262649364164555,
    -0.021092467542944433,
    -0.12536049108358957,
    -0.03258876108151419,
    0.02388014792580539,
    -0.036126241345340725,
    0.06460211280336904,
    -0.0646287111341442,
    0.04380910055994973,
    -0.030728102783435088,
    -0.08226667416354211,
    0.013440643704156392,
    0.056923894518772146,
    -0.023765685452213452,
    0.049394935509177854,
    -0.01261237825706729,
    -0.029325989712175534,
    -0.0109838656473115,
    -0.003674752987009406,
    0.0308357136241467,
    -0.01999919287747308,
    -0.005757158543346644,
    0.047456797572729505,
    -0.06305011060390883,
    0.07904277541887628,
    -0.05915188434488879,
    0.07236884426308565,
    0.06823813160333056,
    0.029436034867147066,
    0.03512919780247052,
    -0.01086010769504274,
    0.04251045935084397,
    -0.029782112439194684,
    0.037243456977403076,
    -0.0003200767102919603,
    0.012553414025324809,
    -0.03477382589259602,
    0.0006416939311696309,
    -0.10031987742602613,
    0.04695039599517967,
    -0.05165413787806065,
    0.05846324611874444,
    -0.053657157983134855,
    -0.09332818536429514,
    -0.04115797885205265,
    0.0309762665887987,
    0.07212416509186878,
    0.027247092839750485,
    0.02401945716691766,
    0.04617831481360928,
    -0.03473997894215037,
    -0.018828777198424785,
    0.0576236093465156,
    -0.031074618717764017,
    -0.027827627336831823,
    0.043824529975528874,
    -0.11570514461297543,
    0.09468222838468435,
    -0.004964394822280571,
    0.06662345035186772,
    0.03578720101756846,
    0.025772633493417175,
    -0.010187661590857213,
    -0.03621978903851601,
    0.04505031424182084,
    -0.023793850658459147,
    0.04151350214219074,
    -0.03405553753746276,
    -0.01111606114695225,
    0.049767080592463486,
    0.057403734853467954,
    0.006427980751146673,
    -0.0891141065063143,
    0.07300944088811451,
    -0.013426049421263776,
    0.016071096477872276,
    0.03204434297263596,
    -0.07661532430613219,
    0.0006107563548289657,
    -0.021255552154608167,
    0.0024180450060464565,
    0.028131375511510816,
    0.02747360628685797,
    0.1354759091104814,
    0.05510852469155526,
    -0.0016238464218303716,
    0.11503775562586546,
    -0.0898761471404503,
    0.11760868585207619,
    -0.0014157940577918878,
    -0.01868008050538293,
    -0.05014908186194041,
    0.04254289614881463,
    0.0540930416233841,
    -0.018040730443765748,
    -0.011445984310903705,
    0.017559438978796634,
    0.0007039860100145923,
    0.01816509412165511,
    -0.022621886608105927,
    0.028048142786600595,
    0.07264563362857826,
    0.00467462319906834,
    -0.03871288914855716,
    0.053877402069984724,
    0.016443872138136157,
    0.06804104411577129,
    -0.14071333522706983,
    0.056423388518635015,
    0.030739200591546834,
    -0.07450140662653647,
    -0.010809777590073986,
    -0.0405032315389239,
    -0.03832107072995083,
    -0.06820155846913899,
    0.05833135421013925,
    0.012082955239274036,
    -0.07094964825428167,
    -0.08769107098469678,
    0.009172633489687169,
    0.08498107835753868,
    0.017266008487816724,
    0.05085988556361543,
    -0.032213365579500025,
    -0.06379694413318313,
    0.0039777096617083715,
    -0.03024684792985632,
    0.018467350818360394,
    0.07270852327389604,
    0.061376217824484505,
    -0.02908019612303054,
    -0.02472140616711713,
    -0.033721242956247975,
    -0.04488316026348925,
    0.11824276761256994,
    -0.0340354745528058,
    -0.07387872918840661,
    0.06533825879646356,
    0.04652998264909596,
    0.024756708242203256,
    0.04964198021282148,
    -0.08055381229342934,
    0.004131585027042069,
    -0.021174595943893693,
    -0.027654331105630335,
    -0.00793091215112179,
    0.04513802941347024,
    -0.05827569465724015,
    -0.1374633047767979,
    0.052634455539601256,
    0.03589545161539661,
    -0.02594621820747982,
    -0.11285419212051734,
    0.016428278923941206,
    -0.10601568455164405,
    0.024160546400590673,
    -0.06000023826464289,
    0.032233433437472266,
    -0.040343323777188286,
    0.06323339114020651,
    -0.0750177461710446,
    -0.06799056292546188,
    0.07507706611759354,
    -0.007214119855613841,
    -0.062417171338001246,
    0.026160684646102855,
    -0.1410632868269898,
    -0.021937039209624472,
    -0.07128095757135687,
    0.04469534347027285
  ]
}
