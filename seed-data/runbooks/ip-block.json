{
  "runbook_id": "runbook-ip-block",
  "title": "Malicious IP Blocking via WAF",
  "description": "Procedure for blocking malicious IP addresses or ranges through the Cloudflare WAF Rulesets API. Includes pre-block verification, rule creation, and post-block monitoring.",
  "content": "When malicious IPs are identified during investigation: (1) Verify the IPs are not internal or partner addresses, (2) Check for existing block rules to avoid duplicates, (3) Create a WAF block rule for the IP range, (4) Monitor for continued malicious traffic from alternate sources, (5) Log the block action for compliance audit.",
  "incident_types": [
    "brute_force",
    "credential_compromise",
    "data_exfiltration",
    "ddos"
  ],
  "applicable_services": [
    "api-gateway",
    "payment-service",
    "user-service"
  ],
  "severity_levels": [
    "critical",
    "high",
    "medium"
  ],
  "steps": [
    {
      "order": 1,
      "action": "Verify target IPs are not internal or trusted partner addresses",
      "command": "vigil-search-asset-criticality",
      "target_system": "elasticsearch",
      "approval_required": false,
      "rollback_command": null
    },
    {
      "order": 2,
      "action": "Create WAF block rule for the malicious IP range",
      "command": "cloudflare-waf create-rule --expression 'ip.src in { {{ip_range}} }' --action block",
      "target_system": "cloudflare-waf",
      "approval_required": false,
      "rollback_command": "cloudflare-waf delete-rule --rule-id {{rule_id}}"
    },
    {
      "order": 3,
      "action": "Monitor for continued malicious traffic from alternate source IPs",
      "command": "vigil-esql-ioc-sweep",
      "target_system": "elasticsearch",
      "approval_required": false,
      "rollback_command": null
    }
  ],
  "historical_success_rate": 0.87,
  "times_used": 15,
  "last_used_at": "2026-02-15T16:45:00.000Z",
  "tags": [
    "ip-block",
    "waf",
    "firewall",
    "cloudflare",
    "containment"
  ],
  "content_vector": [
    0.007213116587260372,
    -0.03355665459275966,
    -0.003884572917687012,
    -0.0022512558915951985,
    0.027211337371687256,
    -0.009408898174112812,
    -0.10765861571448661,
    0.014551946864986513,
    0.03948837753303604,
    0.07723411099425087,
    -0.03223599373243164,
    0.027939404635195578,
    -0.019602354039150803,
    0.07777715007295019,
    0.043727360062585346,
    -0.06997189593045228,
    0.07468487604890575,
    0.054404929850002,
    0.036121710494434744,
    0.026584851908097475,
    -0.012832602949189725,
    -0.019018661814460224,
    0.032425089513344066,
    0.06531656530210425,
    -0.02045954978278602,
    -0.04305056842089529,
    0.07236806893289428,
    0.05607232298319667,
    -0.038405896595523195,
    0.05327505829395034,
    0.04616407898532585,
    -0.018221630227087587,
    0.06753280976230079,
    0.023944928976888033,
    0.05909061773469012,
    -0.05871991001242758,
    0.012741756516353354,
    -0.00874787382421342,
    0.025317927789744673,
    0.056222303229079465,
    0.09476623795717318,
    -0.08599717051962666,
    0.03606387433854214,
    0.0340319944960883,
    -0.045799779614183064,
    0.07679371812915729,
    -0.016400429085530126,
    -0.0673834775359795,
    -0.00045979953278860023,
    0.018410720639080197,
    -0.05827339558301991,
    0.04975633720534636,
    -0.04840928145511826,
    -0.02628004704231198,
    -0.09204729441793846,
    0.011192741114914494,
    0.010064889660510685,
    -0.011865651524773348,
    0.016567271516171034,
    -0.014336180344569068,
    -0.03868157972184233,
    0.05742818415778912,
    -0.03881428172982516,
    0.08725976801924404,
    -0.00649134610698899,
    0.008388781962704867,
    0.0029140176308629366,
    -0.036497552053827924,
    0.06433149945138843,
    -0.04448064518236916,
    -0.01963672361273591,
    0.040845782135922826,
    -0.004298546021604508,
    -0.0038197696034993596,
    -0.019325795511327636,
    0.055454981408660765,
    0.014269406105735512,
    -0.05805267802198386,
    0.024770640952428317,
    -0.005456138440121788,
    -0.030353070348257842,
    -0.003526514846379099,
    0.014070365181651834,
    -0.053907684311903875,
    -0.055312576065212116,
    -0.027274205123857115,
    0.008004206136787543,
    -0.07465889743532064,
    0.027143477072208506,
    0.05245793238636559,
    -0.03483082993137003,
    -0.026753767802459204,
    0.03134958873710578,
    0.03503671799711373,
    0.021076812232352686,
    -0.04416394947689614,
    0.03643413198247379,
    0.020944302786123338,
    0.05849253693996245,
    -0.011526981171914148,
    -0.032383095141162464,
    0.007319643220620297,
    -0.000590524844286299,
    0.0017495541139210806,
    0.011033563195843867,
    -0.09650395714999166,
    0.049493630249577016,
    0.061967473324296266,
    0.05115065838849384,
    0.06564697011140365,
    0.0412291341890556,
    0.09254673409901609,
    -0.007812157561941433,
    -0.09925139663779402,
    0.07341942689457821,
    0.17230840824920846,
    0.008104509931338703,
    0.04016784456496881,
    0.007104590630978815,
    -0.028497596435380287,
    -0.015393641705170666,
    0.01518229111078786,
    -0.02291126268695521,
    0.0011012568636711135,
    -0.014906049451858408,
    0.09450193473631831,
    -0.009024617527635663,
    0.02077408228401821,
    -0.008721049225289993,
    0.014916100256491966,
    -0.055553313680662075,
    0.029749093768389794,
    0.03418548052967196,
    0.01542315917456982,
    -0.024390919030088623,
    -0.13014322946540338,
    0.06712247960026703,
    0.018980972458563374,
    -0.00865898208878209,
    -0.029231937986018783,
    -0.011037847730062982,
    -0.09670348934501773,
    -0.02696435131009173,
    0.013277469900781335,
    -0.08806048588890489,
    -0.06487942815426029,
    0.026931202841066246,
    0.0038902472335951167,
    -0.04797419688332002,
    0.07681955605140249,
    0.019629624218554527,
    0.016975164085057254,
    -0.025461580144786375,
    0.04213913499154926,
    0.03675774170241123,
    -0.023460570277441403,
    0.044381458512553075,
    0.02572036073468523,
    0.02297315727638618,
    0.03126637632084958,
    -0.06058566971032459,
    0.023099013412288316,
    0.01532269552247468,
    0.020046718542246166,
    -0.02924187570858819,
    0.05891524023894176,
    -0.025671495132157652,
    -0.11368114242218759,
    0.09086859215948834,
    0.028346834708588186,
    -0.041727722320558804,
    -0.09701740410603482,
    -0.008121489603556544,
    -0.012342464369517981,
    -0.09487160810728726,
    -0.04069471229137234,
    0.03259116948912163,
    0.006316364390503079,
    0.0380171033285331,
    -0.051208004429803396,
    -0.021796832811336812,
    -0.07712670853049179,
    -0.020228654670850388,
    0.08875710298817725,
    0.0594171175340013,
    0.004467474727385257,
    0.04028871318341216,
    -0.0097248746934232,
    0.024403437622206293,
    0.020330662771098677,
    0.05390137873175497,
    0.04457864949980238,
    -0.06615843373885803,
    0.01455232222471817,
    0.007984613036956962,
    -0.004187892818390159,
    0.05237190156225468,
    -0.07218758351593847,
    0.0362965577089479,
    0.0551318020466814,
    0.03577956634286861,
    -0.041383529810453734,
    -0.05472557081008638,
    0.022236559181153588,
    0.0012279622711829005,
    -0.019678420390786943,
    -0.007689046191552652,
    0.07283062919714646,
    0.031144976329445143,
    -0.013733013432261295,
    0.0016257372234309716,
    0.09570449278877165,
    -0.06149194718707314,
    0.10214178880071956,
    -0.037848945740202526,
    0.0039179171593406404,
    0.0051254347739686556,
    -0.017892455047599152,
    0.0033375361844199722,
    0.04500250617286365,
    -0.042551284754435544,
    -0.011671033076884706,
    -0.010434355733623977,
    -0.02730269660094608,
    -0.04089681247071837,
    0.04154825939585517,
    0.051787815141635794,
    0.014551993519013859,
    0.0001140366787547051,
    -0.045339592859841044,
    0.006830596360304066,
    0.1088060709936902,
    -0.0015130793240502615,
    0.06778873478533054,
    -0.02319358656028908,
    0.005007137347347113,
    0.03960311001494212,
    -0.02917109665424209,
    -0.05765845109429896,
    -0.04154760520652912,
    0.037620363771140496,
    0.0764326088555357,
    0.06932056913575478,
    0.0487397134874667,
    -0.005185256959530167,
    -0.054622321385815964,
    0.025193421684362748,
    -0.044942716860185035,
    -0.07759368664037503,
    0.02333744316548193,
    -0.04586220414864964,
    0.0194531885957353,
    -0.09646737909405385,
    -0.08827693794533403,
    0.014369015005335894,
    0.04873847400349072,
    0.08519206325821835,
    0.07758639801099644,
    0.03610107172061511,
    0.014360879677123406,
    -0.021167215419053507,
    0.0301819552544963,
    0.025856126741835874,
    -0.00464125481969424,
    0.0036609404072471805,
    -0.026900063697768872,
    0.013696124896315172,
    0.0030702674945620482,
    -0.010096395968329562,
    -0.061977661119296056,
    -0.022522310692831317,
    0.0015317509012648105,
    0.04364156213480818,
    0.03499171375008708,
    -0.02294985758801145,
    0.06377160771305902,
    -0.036163395097227186,
    -0.06374870520244696,
    -0.03366228263055738,
    0.03275637935776301,
    0.028443152963667607,
    -0.12096833114406655,
    -0.023446138589676185,
    0.07822670620716018,
    0.07031824886676094,
    -0.0704803229103951,
    -0.021578215819827423,
    -0.05183898576574838,
    -0.09673695852480599,
    0.05179040520179763,
    -0.04970355350094504,
    0.004524345503927417,
    -0.050435412923900275,
    0.008877922825591788,
    0.016843128041440128,
    0.028164244380706846,
    0.04496536178948695,
    0.10235139388891872,
    -0.02310768217870947,
    -0.01557593033072187,
    0.06790467892821164,
    -0.04251305267105781,
    0.003008029656953253,
    -0.008270135924798099,
    -0.08578763431305773,
    -0.01720593055997522,
    -0.04974417239123269,
    -0.11932340397113207,
    -0.022125989925752067,
    0.004718294686317872,
    -0.07112246949844792,
    0.023128370100064362,
    0.04540858864122318,
    -0.07215228933200578,
    -0.027898879695783675,
    -0.05786381449776337,
    -0.02098059599464398,
    -0.074902147642957,
    -0.011492986622691412,
    0.03160674445403053,
    -0.07781886420003938,
    -0.00945110993441941,
    -0.09365110946036471,
    -0.11830813889699095,
    -0.04625389892497927,
    -0.028525882777156057,
    0.12178489141058285,
    -0.04287227378119142,
    0.07185283686562552,
    -0.12553848986302826,
    0.013576203895553031,
    -0.03239625037244676,
    0.026087608162009192,
    0.05249338251172689,
    -0.03815114347338556,
    -0.08764216275785307,
    -0.019071336521740964,
    -0.03195829699673952,
    -0.04203635936373139,
    0.07430942972765818,
    0.008216937831786236,
    0.03105205978137249,
    0.053363333930637975,
    0.027768838369499765,
    -0.06476969654216747,
    0.03088873425261666,
    -0.001403535861173834,
    0.1260621738327725,
    0.09020088863581552,
    -0.06925675053995474,
    -0.056870000902017145,
    -0.0970645697144984,
    0.018116427350084507,
    0.004571413264451672,
    0.024601427236221492,
    -0.0011478195906545112,
    0.05072981395999508,
    -0.08429330892910858,
    -0.04382744108061441,
    -0.031994406435297953,
    -0.0407838505597639,
    -0.04250519304242269,
    0.04074526768588288,
    0.07825795724542213,
    0.027266678854386085,
    -0.04544515321442935,
    0.07085111173798393,
    -0.012899760065453686,
    -0.009911029816797177,
    -0.031545035995849284,
    0.06705801278984085,
    -0.015983351868832152,
    -0.13734962910401857,
    0.04652932017940748,
    0.023331191170293916,
    0.05802556841751946,
    -0.005668247720337763,
    0.14693668823376085,
    -0.0957861883338619,
    0.045606753871787156,
    0.04730053275713764,
    -0.03770718843730943,
    -0.029641486608863708,
    -0.10382369586485794
  ]
}
