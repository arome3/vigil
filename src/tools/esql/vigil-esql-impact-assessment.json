{
  "id": "vigil-esql-impact-assessment",
  "type": "esql",
  "description": "Pre-action service state check before recommending remediation. Verifies current request volume, latency, and error rate to assess collateral impact of proposed actions.",
  "tags": ["vigil", "remediation"],
  "agent": "vigil-commander",
  "configuration": {
    "query": "FROM vigil-metrics-default | WHERE @timestamp > NOW() - 5m AND service.name == ?target_service | STATS active_requests = COUNT(*), avg_latency = AVG(transaction.duration.us), error_rate = SUM(CASE(event.outcome == \"failure\", 1, 0)) / COUNT(*) * 100 BY service.name",
    "params": {
      "target_service": {
        "type": "keyword",
        "required": true,
        "description": "Name of the service targeted for remediation"
      }
    }
  }
}
