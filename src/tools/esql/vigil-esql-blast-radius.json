{
  "id": "vigil-esql-blast-radius",
  "type": "esql",
  "description": "Map lateral movement from compromised hosts by identifying all other hosts that received connections from known compromised IPs within 48 hours. Returns connection counts, unique services, data volume, and confidence scoring.",
  "tags": ["vigil", "investigation"],
  "agent": "vigil-investigator",
  "configuration": {
    "query": "FROM logs-auth-*, logs-network-* | WHERE @timestamp > NOW() - 48h AND source.ip IN (?compromised_ips) AND destination.ip NOT IN (?compromised_ips) | STATS connection_count = COUNT(*), data_volume = SUM(network.bytes), first_seen = MIN(@timestamp), last_seen = MAX(@timestamp) BY destination.ip | EVAL confidence = CASE(connection_count > 100, 0.95, connection_count > 10, 0.75, connection_count > 1, 0.5, 0.3) | SORT confidence DESC, connection_count DESC | LIMIT 25",
    "params": {
      "compromised_ips": {
        "type": "ip",
        "required": true,
        "description": "IP addresses confirmed as compromised"
      }
    }
  }
}
